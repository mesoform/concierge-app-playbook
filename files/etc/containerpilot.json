{
  "consul": "{{ if .CONSUL_AGENT }}localhost{{ else }}{{ if .CONSUL }}{{ .CONSUL }}{{ else }}consul{{ end }}{{ end }}:8500",
  "preStart": ["/usr/local/bin/consul-manage", "preStart"],
  "preStop": ["consul", "leave"],
  "postStop": ["zabbix_sender",
    "-c", "/etc/coprocesses/zabbix/zabbix_agentd.conf",
    "--key", "container.state",
    "--value", "0"],
  "logging": {
    "level": "{{ .LOG_LEVEL }}",
    "format": "{{ .LOG_FORMAT }}"  },
  "tasks": [
    {
      "name": "scheduling_status",
      "command": ["zabbix_sender",
        "-c", "/etc/coprocesses/zabbix/zabbix_agentd.conf",
        "--key", "container.state",
        "--value", "1"],
      "frequency": "10000ms",
      "timeout": "3000ms"
    }
  ],
  "coprocesses": [
    {
      "name": "zabbix_agent",
      "command": ["/usr/sbin/zabbix_agentd", "-fc", "/etc/coprocesses/zabbix/zabbix_agentd.conf"],
      "restarts": 3
    }
  ],
  "services": [
    {
      "name": "consul",
      "port": 8500,
      "health": ["/usr/local/bin/consul-manage", "health"],
      "poll": 10,
      "ttl": 25,
      "tags": [
        "service",
        "discovery",
        "consul"
      ],
      "consul": {
        "enableTagOverride": true,
        "deregisterCriticalServiceAfter": "30m"
      }
    }
  ]
}
